{% extends "hr/leave_officer/leave_base.html" %}
{% block title %}Late Computation | Leave Officer{% endblock %}

{% block content %}
<main class="p-6 space-y-6 bg-[#0f172a] min-h-screen text-gray-100">

  <!-- ================= HEADER + FILTER ================= -->
  <div class="bg-[#1e293b] p-4 rounded-2xl shadow border border-gray-700">
    <form method="get" class="flex flex-wrap items-end gap-6">

      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-400">Month</label>
        <select name="month"
          class="mt-1 bg-[#111827] text-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
          {% for m in range(1,13) %}
            <option value="{{ m }}" {% if m == month %}selected{% endif %}>
              {{ datetime(2000, m, 1).strftime('%B') }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-400">Year</label>
        <select name="year"
          class="mt-1 bg-[#111827] text-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
          {% for y in range(2020, datetime.now().year + 1) %}
            <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
          {% endfor %}
        </select>
      </div>

      <button type="submit"
        class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-xl flex items-center gap-2 transition">
        <i class="fa-solid fa-filter"></i>
        <span>Filter</span>
      </button>

    </form>
  </div>

  <!-- ================= TABLE ================= -->
  <div class="overflow-x-auto rounded-2xl shadow border border-gray-700 bg-[#1e293b]">
    <table class="min-w-full divide-y divide-gray-700 text-sm table-auto">

      <!-- HEADER -->
      <thead class="bg-[#111827] text-gray-400 sticky top-0 z-10">
        <tr>
          <th class="px-3 py-3 text-left">NAME</th>
          <th class="px-3 py-3 text-left">CATEGORY</th>

          <th class="px-3 py-3 text-center">TOTAL LATE</th>
          <th class="px-3 py-3 text-center">NO. OF DAYS LATE</th>
          <th class="px-3 py-3 text-center">LATE DEDUCTION</th>

          <th class="px-3 py-3 text-center">TOTAL UNDERTIME</th>
          <th class="px-3 py-3 text-center">NO. OF DAYS UNDERTIME</th>
          <th class="px-3 py-3 text-center">UNDERTIME DEDUCTION</th>

          <th class="px-3 py-3 text-center">OVER-ALL TOTAL MINUTES</th>
          <th class="px-3 py-3 text-center">OVER-ALL DAYS</th>
          <th class="px-3 py-3 text-center">OVER-ALL DEDUCTION</th>

          {% for d in range(1, days_in_month + 1) %}
            <th colspan="4" class="px-1 py-2 text-center">DAY {{ d }}</th>
          {% endfor %}
        </tr>

        <tr class="bg-[#0f172a] text-[10px] text-gray-400">
          {% for d in range(1, days_in_month + 1) %}
            <th class="px-1 py-1">IN</th>
            <th class="px-1 py-1">LATE</th>
            <th class="px-1 py-1">OUT</th>
            <th class="px-1 py-1">UT</th>
          {% endfor %}
        </tr>
      </thead>

      <!-- BODY -->
      <tbody class="divide-y divide-gray-700">
        {% for row in data %}
        <tr class="hover:bg-[#111827] transition">

          <td class="px-3 py-2">{{ row.employee.get_full_name() }}</td>
          <td class="px-3 py-2">{{ row.employee.employment_type.name }}</td>

          <td class="px-3 py-2 text-center">{{ row.total_late_minutes }}</td>
          <td class="px-3 py-2 text-center">{{ "%.3f"|format(row.total_late_minutes / 480) }}</td>
          <td class="px-3 py-2 text-center">-</td>

          <td class="px-3 py-2 text-center">{{ row.total_undertime_minutes }}</td>
          <td class="px-3 py-2 text-center">{{ "%.3f"|format(row.total_undertime_minutes / 480) }}</td>
          <td class="px-3 py-2 text-center">-</td>

          <td class="px-3 py-2 text-center">
            {{ row.total_late_minutes + row.total_undertime_minutes }}
          </td>
          <td class="px-3 py-2 text-center">
            {{ "%.3f"|format((row.total_late_minutes + row.total_undertime_minutes) / 480) }}
          </td>
          <td class="px-3 py-2 text-center">-</td>

          {% for d in range(1, days_in_month + 1) %}
            {% set day = row.days.get(d) %}
            <td class="px-1 py-1 text-center">{{ day.time_in if day else '-' }}</td>
            <td class="px-1 py-1 text-center">{{ day.late if day else '-' }}</td>
            <td class="px-1 py-1 text-center">{{ day.time_out if day else '-' }}</td>
            <td class="px-1 py-1 text-center">{{ day.undertime if day else '-' }}</td>
          {% endfor %}
        </tr>
        {% else %}
        <tr>
          <td colspan="{{ 11 + (days_in_month * 4) }}"
              class="text-center py-4 text-gray-400">
            No records found.
          </td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>

</main>
{% endblock %}
