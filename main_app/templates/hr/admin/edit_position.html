{% extends 'hr/admin/admin_base.html' %}
{% block title %}Edit Position{% endblock %}

{% block content %}
<main class="p-6 text-gray-100">
  <!-- Header -->
  <header class="mb-8">
    <h1 class="text-3xl font-bold text-blue-400">Edit Position</h1>
    <p class="text-gray-400">Update the details of the selected position.</p>
  </header>

  <!-- Card -->
  <div class="bg-[#1e293b] border border-blue-900/40 rounded-2xl shadow-xl p-8 w-full max-w-3xl mx-auto">
    <h2 class="text-xl font-semibold text-blue-400 mb-6 flex items-center gap-2">
      <span class="material-symbols-outlined text-blue-400">edit</span>
      Position Details
    </h2>

    <form
      id="editPositionForm"
      method="POST"
      action="{{ url_for('hr_admin.edit_position', position_id=position.id) }}"
      class="space-y-6"
    >
      {{ form.hidden_tag() if form else '' }}

      <!-- Position Name -->
      <div>
        <label class="block text-gray-300 font-medium mb-2">Position Name</label>
        <input
          type="text"
          name="name"
          value="{{ position.name }}"
          placeholder="Enter position name"
          required
          class="w-full px-4 py-3 bg-[#0f172a] border border-gray-700 rounded-xl text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
        />
      </div>

      <!-- Description -->
      <div>
        <label class="block text-gray-300 font-medium mb-2">Description</label>
        <textarea
          name="description"
          rows="4"
          placeholder="Enter position description"
          class="w-full px-4 py-3 bg-[#0f172a] border border-gray-700 rounded-xl text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition resize-none"
        >{{ position.description }}</textarea>
      </div>

      <!-- Buttons -->
      <div class="pt-4 flex flex-wrap gap-3">
        <!-- Update -->
        <button
          type="submit"
          class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-3 rounded-xl shadow-md hover:shadow-blue-500/30 transition"
        >
          <span class="material-symbols-outlined">update</span>
          Update Position
        </button>

        <!-- Cancel -->
        <a
          href="{{ url_for('hr_admin.view_positions') }}"
          class="flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white font-medium px-6 py-3 rounded-xl shadow-md transition"
        >
          <span class="material-symbols-outlined">cancel</span>
          Cancel
        </a>
      </div>
    </form>
  </div>
</main>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.getElementById("editPositionForm").addEventListener("submit", function(e){
  e.preventDefault();

  Swal.fire({
    background: '#ffffff',
    color: '#1e293b',
    title: 'Confirm Update',
    text: 'Do you want to update this position?',
    icon: 'warning',
    iconColor: '#2563eb',
    showCancelButton: true,
    confirmButtonColor: '#2563eb',
    cancelButtonColor: '#dc2626',
    confirmButtonText: 'Yes, Update',
    cancelButtonText: 'Cancel',
    customClass: {
      popup: 'rounded-2xl shadow-lg',
      title: 'text-lg font-semibold'
    }
  }).then((result) => {
    if (result.isConfirmed) {
      const formData = new FormData(this);

      fetch(this.action, {
        method: 'POST',
        body: formData,
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === "success") {
          Swal.fire('Updated!', data.message, 'success').then(() => {
            window.location.href = "{{ url_for('hr_admin.view_positions') }}";
          });
        } else {
          Swal.fire('Error!', data.message, 'error');
        }
      })
      .catch(() => {
        Swal.fire('Error!', 'Something went wrong.', 'error');
      });
    }
  });
});
</script>
{% endblock %}
