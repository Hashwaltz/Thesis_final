{% extends "hr/employee/employee_base.html" %}
{% block title %}Employee Dashboard{% endblock %}

{% block content %}
<section class="p-6 space-y-8">

  {% if not_assigned %}
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    Swal.fire({
      icon: 'info',
      title: 'Access Denied',
      text: 'You are not assigned to any department yet.',
      confirmButtonText: 'OK'
    }).then(() => {
      window.location.href = "{{ url_for('hr_auth.logout') }}";
    });
  </script>
  {% endif %}

  <!-- Header -->
  <h1 class="text-2xl font-semibold text-blue-400 flex items-center gap-2">
    <i class="fa-solid fa-gauge-high text-3xl"></i>
    {{ current_user.get_full_name() }} Dashboard
  </h1>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- Employees -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-md border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-blue-600 bg-opacity-20 rounded-full">
        <i class="fa-solid fa-users text-blue-400 text-3xl"></i>
      </div>
      <div>
        <p class="text-gray-400 text-sm">Employees</p>
        <h2 class="text-3xl font-bold text-blue-400 mt-1">{{ current_user.department.employees|length }}</h2>
      </div>
    </div>

    <!-- Present -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-md border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-emerald-600 bg-opacity-20 rounded-full">
        <i class="fa-solid fa-circle-check text-emerald-400 text-3xl"></i>
      </div>
      <div>
        <p class="text-gray-400 text-sm">Present (Month)</p>
        <h2 class="text-3xl font-bold text-emerald-400 mt-1">{{ attendance_summary.total_present or 0 }}</h2>
      </div>
    </div>

    <!-- Absent -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-md border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-red-600 bg-opacity-20 rounded-full">
        <i class="fa-solid fa-circle-xmark text-red-400 text-3xl"></i>
      </div>
      <div>
        <p class="text-gray-400 text-sm">Absent (Month)</p>
        <h2 class="text-3xl font-bold text-red-400 mt-1">{{ attendance_summary.total_absent or 0 }}</h2>
      </div>
    </div>

    <!-- Late -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-md border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-yellow-400 bg-opacity-20 rounded-full">
        <i class="fa-solid fa-clock text-yellow-400 text-3xl"></i>
      </div>
      <div>
        <p class="text-gray-400 text-sm">Late (Month)</p>
        <h2 class="text-3xl font-bold text-yellow-400 mt-1">{{ attendance_summary.total_late or 0 }}</h2>
      </div>
    </div>
  </div>

  <!-- Attendance Trend Chart -->
  <div class="bg-gray-800 p-6 rounded-2xl shadow-md border border-gray-700">
    <h3 class="text-sm font-semibold text-blue-400 mb-4 flex items-center gap-2">
      <i class="fa-solid fa-chart-line"></i>
      Monthly Attendance Trend
    </h3>
    <div class="relative h-[400px]">
      <canvas id="attendanceTrendChart"></canvas>
    </div>
  </div>

  <!-- Leave Balances -->
  <div class="bg-gray-800 p-6 rounded-2xl shadow-md border border-gray-700">
    <h3 class="text-sm font-semibold text-blue-400 mb-4 flex items-center gap-2">
      <i class="fa-solid fa-calendar-check"></i>
      Leave Credits Available
    </h3>
    <div class="bg-slate-700 p-4 rounded-xl flex flex-col sm:flex-row sm:justify-between items-center gap-4">
      <div class="text-center sm:text-left">
        <p class="text-gray-300 text-sm">Vacation Leave</p>
        <h2 class="text-2xl font-bold text-green-400">{{ leave_balances.Vacation or 0 }} days</h2>
      </div>
      <div class="text-center sm:text-left">
        <p class="text-gray-300 text-sm">Sick Leave</p>
        <h2 class="text-2xl font-bold text-yellow-400">{{ leave_balances.Sick or 0 }} days</h2>
      </div>
      <div class="text-center sm:text-left">
        <p class="text-gray-300 text-sm">Emergency Leave</p>
        <h2 class="text-2xl font-bold text-red-400">{{ leave_balances.Emergency or 0 }} days</h2>
      </div>
    </div>
    {% if leave_balances.note %}
      <p class="text-gray-400 text-sm mt-3 italic">{{ leave_balances.note }}</p>
    {% endif %}
  </div>

</section>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById("attendanceTrendChart"), {
  type: "line",
  data: {
    labels: {{ attendance_chart.dates|tojson }},
    datasets: [
      {
        label: "Present",
        data: {{ attendance_chart.present_counts|tojson }},
        borderColor: "#10b981",
        backgroundColor: "#10b98133",
        tension: 0.4,
        fill: true
      },
      {
        label: "Absent",
        data: {{ attendance_chart.absent_counts|tojson }},
        borderColor: "#ef4444",
        backgroundColor: "#ef444433",
        tension: 0.4,
        fill: true
      },
      {
        label: "Late",
        data: {{ attendance_chart.late_counts|tojson }},
        borderColor: "#facc15",
        backgroundColor: "#facc1533",
        tension: 0.4,
        fill: true
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    layout: { padding: 20 },
    plugins: {
      legend: { labels: { color: "#d1d5db" } }
    },
    scales: {
      x: { ticks: { color: "#9ca3af" } },
      y: { ticks: { color: "#9ca3af" }, beginAtZero: true }
    }
  }
});
</script>
{% endblock %}
