{% extends 'hr/employee/employee_base.html' %}

{% block title %}Request Leave{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto p-6 bg-gray-800 rounded-xl shadow-md space-y-6">

  <!-- Header -->
  <header>
    <h1 class="text-2xl font-bold text-blue-400 flex items-center gap-2">
      <i class="fa-solid fa-calendar-days text-2xl"></i>
      Request Leave
    </h1>
  </header>

  <!-- Leave Form -->
  <form id="leaveForm" method="POST" class="space-y-6">

    <!-- Leave Type -->
    <div class="flex flex-col">
      <label for="leave_type" class="text-gray-200 font-medium mb-2">Leave Type</label>
      <select name="leave_type" id="leave_type" required
              class="bg-gray-700 text-gray-100 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option value="">Select Leave Type</option>
        {% for lt in leave_types %}
        <option value="{{ lt.id }}">{{ lt.name }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Start Date & End Date -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="flex flex-col">
        <label for="start_date" class="text-gray-200 font-medium mb-2">Start Date</label>
        <input type="date" name="start_date" id="start_date" required
               class="bg-gray-700 text-gray-100 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
      <div class="flex flex-col">
        <label for="end_date" class="text-gray-200 font-medium mb-2">End Date</label>
        <input type="date" name="end_date" id="end_date" required
               class="bg-gray-700 text-gray-100 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
    </div>

    <!-- Reason -->
    <div class="flex flex-col">
      <label for="reason" class="text-gray-200 font-medium mb-2">Reason</label>
      <textarea name="reason" id="reason" rows="4" placeholder="Enter reason..." required
                class="bg-gray-700 text-gray-100 px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-end">
      <button type="submit" id="submitBtn"
              class="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-md transition">
        <i class="fa-solid fa-paper-plane"></i>
        Submit Request
      </button>
    </div>

  </form>
</div>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  const leaveForm = document.getElementById('leaveForm');

  leaveForm.addEventListener('submit', function(e) {
    e.preventDefault(); // Prevent default submission

    Swal.fire({
      title: 'Submit Leave Request?',
      text: "Are you sure you want to submit this leave request?",
      icon: 'question',
      showCancelButton: true,
      confirmButtonColor: '#3b82f6',
      cancelButtonColor: '#ef4444',
      confirmButtonText: 'Yes, submit it!',
      cancelButtonText: 'Cancel'
    }).then((result) => {
      if (result.isConfirmed) {
        leaveForm.submit();
      }
    });
  });

  // Flash messages
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, msg in messages %}
      Swal.fire({
        icon: '{{ "success" if category=="success" else "error" }}',
        title: msg,
        timer: 2000,
        showConfirmButton: false
      });
    {% endfor %}
  {% endwith %}
</script>
{% endblock %}
