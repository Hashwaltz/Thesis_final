{% extends 'payroll/admin/payroll_admin_base.html' %}
{% block title %}Payroll Admin - Payroll Periods{% endblock %}

{% block content %}
<section class="p-6 space-y-6 text-gray-200">

  <!-- ===== HEADER ===== -->
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-semibold text-emerald-400">Payroll Periods</h1>
    <a href="{{ url_for('payroll_admin.add_payroll_period') }}"
       class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-500 rounded-lg text-white transition">
      <i class="fa-solid fa-plus"></i>
      Add Payroll Period
    </a>
  </div>

  <!-- ===== FILTERS ===== -->
  <form method="GET" class="flex flex-wrap gap-4 mb-4">
    <!-- Status -->
    <div class="flex flex-col">
      <label for="status" class="text-gray-300">Status</label>
      <select name="status" id="status" class="px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-200">
        <option value="">All</option>
        <option value="Open" {% if request.args.get('status') == 'Open' %}selected{% endif %}>Open</option>
        <option value="Processing" {% if request.args.get('status') == 'Processing' %}selected{% endif %}>Processing</option>
        <option value="Closed" {% if request.args.get('status') == 'Closed' %}selected{% endif %}>Closed</option>
      </select>
    </div>

    <!-- Start Date -->
    <div class="flex flex-col">
      <label for="start_date" class="text-gray-300">Start Date From</label>
      <input type="date" name="start_date" id="start_date"
             value="{{ request.args.get('start_date', '') }}"
             class="px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-200">
    </div>

    <!-- End Date -->
    <div class="flex flex-col">
      <label for="end_date" class="text-gray-300">End Date To</label>
      <input type="date" name="end_date" id="end_date"
             value="{{ request.args.get('end_date', '') }}"
             class="px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-200">
    </div>

    <div class="flex items-end">
      <button type="submit"
              class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg text-white transition">
        Filter
      </button>
    </div>
  </form>

  <!-- ===== PAYROLL PERIODS TABLE ===== -->
  <div class="overflow-x-auto bg-gray-800 rounded-2xl border border-gray-700">
    <table class="min-w-full divide-y divide-gray-700 text-sm">
      <thead class="bg-gray-900">
        <tr>
          <th class="px-6 py-3 text-left text-gray-400">Period Name</th>
          <th class="px-6 py-3 text-left text-gray-400">Start Date</th>
          <th class="px-6 py-3 text-left text-gray-400">End Date</th>
          <th class="px-6 py-3 text-left text-gray-400">Pay Date</th>
          <th class="px-6 py-3 text-left text-gray-400">Status</th>
          <th class="px-6 py-3 text-left text-gray-400">Created At</th>
          <th class="px-6 py-3 text-left text-gray-400">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-700">
        {% if periods %}
          {% for period in periods %}
          <tr class="hover:bg-gray-700/50 transition">
            <td class="px-6 py-3">{{ period.period_name }}</td>
            <td class="px-6 py-3">{{ period.start_date.strftime('%b %d, %Y') }}</td>
            <td class="px-6 py-3">{{ period.end_date.strftime('%b %d, %Y') }}</td>
            <td class="px-6 py-3">{{ period.pay_date.strftime('%b %d, %Y') }}</td>
            <td class="px-6 py-3 font-semibold"
                style="color:
                  {% if period.status == 'Open' %}#10b981
                  {% elif period.status == 'Processing' %}#f59e0b
                  {% else %}#ef4444
                  {% endif %};">
              {{ period.status }}
            </td>
            <td class="px-6 py-3">{{ period.created_at.strftime('%b %d, %Y') }}</td>
            <td class="px-6 py-3">
              <a href="{{ url_for('payroll_admin.edit_payroll_period', period_id=period.id) }}"
                 class="flex items-center gap-1 px-3 py-1 bg-yellow-500 hover:bg-yellow-400 rounded-lg text-gray-900 text-sm transition">
                <i class="fa-solid fa-pen-to-square"></i>
                Edit
              </a>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="7" class="px-6 py-4 text-center text-gray-400">
              No payroll periods found.
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <!-- ===== PAGINATION ===== -->
  <div class="flex justify-center items-center gap-4 mt-4">
    {% if pagination.has_prev %}
      <a href="{{ url_for('payroll_admin.view_payroll_periods', page=pagination.prev_num, status=request.args.get('status',''), start_date=request.args.get('start_date',''), end_date=request.args.get('end_date','')) }}"
         class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded-lg text-gray-200 transition">Previous</a>
    {% endif %}

    <span class="text-gray-400">Page {{ pagination.page }} of {{ pagination.pages }}</span>

    {% if pagination.has_next %}
      <a href="{{ url_for('payroll_admin.view_payroll_periods', page=pagination.next_num, status=request.args.get('status',''), start_date=request.args.get('start_date',''), end_date=request.args.get('end_date','')) }}"
         class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded-lg text-gray-200 transition">Next</a>
    {% endif %}
  </div>

</section>
{% endblock %}
