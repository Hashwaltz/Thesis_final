{% extends 'payroll/admin/payroll_admin_base.html' %}
{% block title %}Payroll Admin - Employees{% endblock %}

{% block content %}
<section class="p-6 space-y-6 text-gray-200">

  <!-- ===== HEADER ===== -->
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-semibold text-emerald-400">Employee Records</h1>
  </div>

  <!-- ===== FILTERS ===== -->
  <form method="get" action="{{ url_for('payroll_admin.view_employees') }}" id="employeeFilterForm" class="flex flex-wrap gap-4 mb-4">
    <!-- Search -->
    <div class="flex flex-col">
      <label for="search" class="text-gray-300">Search</label>
      <div class="flex">
        <input type="text" name="search" value="{{ search }}" placeholder="Search employees..." 
               class="px-3 py-2 rounded-l-lg bg-gray-800 border border-gray-700 text-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <button type="submit" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-500 rounded-r-lg text-white transition">Filter</button>
      </div>
    </div>

    <!-- Department Filter -->
    <div class="flex flex-col">
      <label for="department_id" class="text-gray-300">Department</label>
      <select name="department_id" id="departmentSelect" 
              class="px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <option value="">All Departments</option>
        {% for dept in departments %}
          <option value="{{ dept.id }}" {% if dept.id == selected_department|int %}selected{% endif %}>{{ dept.name }}</option>
        {% endfor %}
      </select>
    </div>
  </form>

  <!-- ===== EMPLOYEE TABLE ===== -->
  <div class="overflow-x-auto bg-gray-800 rounded-2xl border border-gray-700">
    <table class="min-w-full divide-y divide-gray-700 text-sm">
      <thead class="bg-gray-900">
        <tr>
          <th class="px-6 py-3 text-left text-gray-400">Employee ID</th>
          <th class="px-6 py-3 text-left text-gray-400">Full Name</th>
          <th class="px-6 py-3 text-left text-gray-400">Email</th>
          <th class="px-6 py-3 text-left text-gray-400">Department</th>
          <th class="px-6 py-3 text-left text-gray-400">Position</th>
          <th class="px-6 py-3 text-left text-gray-400">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-700">
        {% if employees.items %}
          {% for employee in employees.items %}
          <tr class="hover:bg-gray-700/50 transition">
            <td class="px-6 py-3">{{ employee.employee_id }}</td>
            <td class="px-6 py-3">{{ employee.first_name }} {{ employee.last_name }}</td>
            <td class="px-6 py-3">{{ employee.email }}</td>
            <td class="px-6 py-3">{{ employee.department.name if employee.department else '-' }}</td>
            <td class="px-6 py-3">{{ employee.position.name if employee.position else '-' }}</td>
            <td class="px-6 py-3">
              <a href="#" data-id="{{ employee.id }}" 
                class="flex justify-center items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg text-white text-sm transition">
                  <i class="fa-solid fa-eye"></i>
                  <span>View</span>
              </a>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="6" class="px-6 py-4 text-center text-gray-400">
              No employees found.
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <!-- ===== PAGINATION ===== -->
  <div class="flex justify-center items-center gap-4 mt-4">
    {% if employees.has_prev %}
      <a href="{{ url_for('payroll_admin.view_employees', page=employees.prev_num, search=search, department_id=selected_department) }}"
         class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded-lg text-gray-200 transition">Previous</a>
    {% endif %}

    <span class="text-gray-400">Page {{ employees.page }} of {{ employees.pages }}</span>

    {% if employees.has_next %}
      <a href="{{ url_for('payroll_admin.view_employees', page=employees.next_num, search=search, department_id=selected_department) }}"
         class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded-lg text-gray-200 transition">Next</a>
    {% endif %}
  </div>

</section>

<!-- ===== AUTO-SUBMIT DEPARTMENT FILTER ===== -->
<script>
  document.getElementById('departmentSelect').addEventListener('change', function() {
    document.getElementById('employeeFilterForm').submit();
  });
</script>
{% endblock %}
