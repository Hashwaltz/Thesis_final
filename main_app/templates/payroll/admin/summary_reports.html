{% extends 'payroll/admin/payroll_admin_base.html' %}
{% block title %}Payroll Summary Reports{% endblock %}

{% block content %}

<!-- âœ… Google Material Icons -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

<main class="content-wrap">
  <header class="content-head">
    <h1><b>Payroll Summary Reports</b></h1>
  </header>

  <!-- ðŸ” Filter Form -->
  <section class="searching">
    <form method="get" class="fields">
      <div class="input-field">
        <label for="department_id">Department:</label>
        <select name="department_id" id="department_id">
          <option value="">All Departments</option>
          {% for d in departments %}
          <option value="{{ d.id }}" {% if selected_department == d.id %}selected{% endif %}>{{ d.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="input-field">
        <label for="start_date">Start Date:</label>
        <input type="date" name="start_date" id="start_date" value="{{ start_date or '' }}">
      </div>

      <div class="input-field">
        <label for="end_date">End Date:</label>
        <input type="date" name="end_date" id="end_date" value="{{ end_date or '' }}">
      </div>

      <button type="submit" style="display: flex; align-items: center; gap: 5px;">
        <span class="material-symbols-outlined">filter_alt</span>
        <span class="btnText">Filter</span>
      </button>
    </form>
  </section>

  <!-- ðŸ“ Export Buttons -->
  <div style="display: flex; gap: 10px; margin-top: 20px;">
    <button class="printing" style="display: flex; align-items: center; gap: 5px;">
      <span class="material-symbols-outlined">table_chart</span>
      <a href="{{ url_for('payroll_admin.export_excel', department_id=selected_department, start_date=start_date, end_date=end_date) }}">
        Export Excel
      </a>
    </button>
    <button class="printing" style="background-color: #dc3545; display: flex; align-items: center; gap: 5px;">
      <span class="material-symbols-outlined">picture_as_pdf</span>
      <a href="{{ url_for('payroll_admin.export_pdf', department_id=selected_department, start_date=start_date, end_date=end_date) }}">
        Export PDF
      </a>
    </button>
  </div>

  <!-- ðŸ“‹ Summary Table -->
  <div class="table-container" style="margin-top: 20px;">
    <table>
      <thead>
        <tr>
          <th>Department</th>
          <th>Total Gross Pay</th>
          <th>Total Deductions</th>
          <th>Total Net Pay</th>
        </tr>
      </thead>
      <tbody>
        {% for r in results %}
        <tr>
          <td data-label="Department">{{ r.department_name }}</td>
          <td data-label="Total Gross Pay">â‚± {{ "%.2f"|format(r.total_gross or 0) }}</td>
          <td data-label="Total Deductions">â‚± {{ "%.2f"|format(r.total_deductions or 0) }}</td>
          <td data-label="Total Net Pay">â‚± {{ "%.2f"|format(r.total_net or 0) }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4" style="text-align:center;">No records found</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- ðŸ“„ Pagination -->
    {% if pagination.pages > 1 %}
    <div class="pagination" style="margin-top: 20px; text-align: center; display: flex; justify-content: center; align-items: center; gap: 10px;">
      {% if pagination.has_prev %}
        <a href="{{ url_for('payroll_admin.payroll_summary', page=pagination.prev_num, department_id=selected_department, start_date=start_date, end_date=end_date) }}" 
           style="display: flex; align-items: center; gap: 4px;">
          <span class="material-symbols-outlined">arrow_back_ios</span> Previous
        </a>
      {% endif %}

      <span>Page {{ pagination.page }} of {{ pagination.pages }}</span>

      {% if pagination.has_next %}
        <a href="{{ url_for('payroll_admin.payroll_summary', page=pagination.next_num, department_id=selected_department, start_date=start_date, end_date=end_date) }}" 
           style="display: flex; align-items: center; gap: 4px;">
          Next <span class="material-symbols-outlined">arrow_forward_ios</span>
        </a>
      {% endif %}
    </div>
    {% endif %}
  </div>
</main>
{% endblock %}
 