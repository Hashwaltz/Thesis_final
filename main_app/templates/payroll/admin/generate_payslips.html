{% extends 'payroll/admin/payroll_admin_base.html' %}
{% block title %}Generate Payslips by Period{% endblock %}

{% block content %}
<main class="p-6 bg-gray-900 min-h-screen text-gray-200">
  <header class="mb-6">
    <h1 class="text-3xl font-bold text-gray-100">Generate Payslips by Payroll Period</h1>
  </header>

  <div class="max-w-md mx-auto bg-gray-800 p-6 rounded-lg shadow-md">

    <form method="POST" id="generateForm" class="space-y-4">

      <div>
        <label for="pay_period_id" class="block font-semibold mb-2 text-gray-300">Select Payroll Period:</label>
        <select name="pay_period_id" id="pay_period_id" required
          class="w-full bg-gray-700 text-gray-200 border border-gray-600 rounded-md px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500">
          <option value="">-- Choose Payroll Period --</option>
          {% for p in payroll_periods %}
            <option value="{{ p.id }}">
              {{ p.start_date.strftime('%B %d, %Y') }} — {{ p.end_date.strftime('%B %d, %Y') }}
            </option>
          {% endfor %}
        </select>
      </div>

      <button type="button" id="generateBtn"
        class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-md transition">
        Generate Payslips
      </button>

      <a href="{{ url_for('payroll_admin.view_payslips') }}" 
        class="block text-center mt-2 text-blue-500 hover:underline">
        ← Back to Payslip List
      </a>

    </form>
  </div>
</main>

<!-- SweetAlert Confirmation -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.getElementById("generateBtn").addEventListener("click", function() {
  const period = document.getElementById("pay_period_id").value;
  if (!period) {
    Swal.fire('No Period Selected', 'Please choose a payroll period first.', 'warning');
    return;
  }

  Swal.fire({
    title: 'Generate Payslips?',
    text: 'Payslips will be generated for all employees under the selected payroll period.',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#198754',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Yes, generate',
    cancelButtonText: 'Cancel'
  }).then((result) => {
    if (result.isConfirmed) {
      document.getElementById("generateForm").submit();
    }
  });
});
</script>
{% endblock %}
