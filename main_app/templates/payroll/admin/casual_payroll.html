{% extends 'payroll/admin/payroll_admin_base.html' %}
{% block title %}Admin - Casual Payroll Processing{% endblock %}

{% block content %}
<main class="p-6 bg-gray-900 min-h-screen text-gray-200">
  <h2 class="text-2xl font-bold mb-4">Casual Payroll Processing</h2>

  <!-- Payroll Period Selector -->
  <div class="mb-6">
    <form id="payrollPeriodForm" class="flex flex-wrap gap-4 items-end">
      <div>
        <label for="pay_period_id" class="block mb-1 text-gray-300">Select Payroll Period</label>
        <select id="pay_period_id" class="bg-gray-800 text-gray-200 border border-gray-600 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          <option value="">-- Select Period --</option>
          {% for period in payroll_periods %}
            <option value="{{ period.id }}">{{ period.start_date }} to {{ period.end_date }}</option>
          {% endfor %}
        </select>
      </div>
      <button type="button" onclick="calculateWorkedDays()"
              class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">
        Calculate Worked Days
      </button>
    </form>
  </div>

  <!-- Selected Department -->
  {% if selected_department %}
  <div class="mb-4">
    <strong class="text-gray-300">Department:</strong> {{ selected_department }}
  </div>
  {% endif %}

  <!-- Payroll Table -->
  <div class="overflow-x-auto bg-gray-800 rounded-lg shadow-md p-4">
    <table class="min-w-full divide-y divide-gray-700">
      <thead class="bg-gray-700 text-gray-300">
        <tr>
          <th class="px-4 py-2 text-center">Employee</th>
          <th class="px-4 py-2 text-center">Employment Type</th>
          <th class="px-4 py-2 text-center">Daily Salary</th>
          <th class="px-4 py-2 text-center">Allowance</th>
          <th class="px-4 py-2 text-center">Worked Days</th>
          <th class="px-4 py-2 text-center">SSS</th>
          <th class="px-4 py-2 text-center">PhilHealth</th>
          <th class="px-4 py-2 text-center">Pag-IBIG</th>
          <th class="px-4 py-2 text-center">Tax</th>
          <th class="px-4 py-2 text-center">Other Deductions</th>
          <th class="px-4 py-2 text-center">Net Pay</th>
          <th class="px-4 py-2 text-center">Action</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-700">
        {% if employees %}
          {% for emp in employees %}
          <tr id="row-{{ emp.id }}" data-existing-periods="{{ emp.existing_payrolls|join(',') }}" class="hover:bg-gray-700">
            <td class="px-4 py-2 text-center">{{ emp.full_name }}</td>
            <td class="px-4 py-2 text-center">{{ emp.employment_type if emp.employment_type else "N/A" }}</td>
            <td class="px-4 py-2 text-center"><input type="text" name="basic_salary" value="{{ emp.basic_salary }}" class="table-input numeric-input" readonly/></td>
            <td class="px-4 py-2 text-center"><input type="text" name="allowance" value="{{ emp.allowance }}" class="table-input numeric-input"/></td>
            <td class="px-4 py-2 text-center worked-days">0.00</td>
            <td class="px-4 py-2 text-center"><input type="text" name="sss" value="{{ emp.sss }}" class="table-input numeric-input"/></td>
            <td class="px-4 py-2 text-center"><input type="text" name="philhealth" value="{{ emp.philhealth }}" class="table-input numeric-input"/></td>
            <td class="px-4 py-2 text-center"><input type="text" name="pagibig" value="{{ emp.pagibig }}" class="table-input numeric-input"/></td>
            <td class="px-4 py-2 text-center"><input type="text" name="tax" value="0" class="table-input numeric-input"/></td>
            <td class="px-4 py-2 text-center"><input type="text" name="other" value="0" class="table-input numeric-input"/></td>
            <td class="px-4 py-2 text-center net_pay">â‚± 0.00</td>
            <td class="px-4 py-2 text-center">
              <button class="btn-action bg-green-600 hover:bg-green-700 transition" onclick="processPayroll({{ emp.id }})">Process</button>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="12" class="px-4 py-6 text-center text-gray-400">No employees found for payroll processing.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</main>

<!-- Tailwind Styled Inputs & Buttons -->
<style>
.table-input {
  @apply bg-gray-700 text-gray-200 border border-gray-600 rounded-md px-2 py-1 text-center w-24;
}
.btn-action {
  @apply text-white px-3 py-1 rounded-md;
}
.btn-action:disabled {
  @apply bg-gray-600 cursor-not-allowed;
}
</style>
{% endblock %}
