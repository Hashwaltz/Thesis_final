{% extends 'payroll/staff/staff_base.html' %}
{% block title %}Generate Payslips by Period{% endblock %}

{% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Generate Payslips by Payroll Period</b></h1>
  </header>

  <div class="form-container" 
       style="max-width: 500px; margin: 30px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.1);">

    <form method="POST" id="generateForm">
      <label for="pay_period_id" style="font-weight: bold;">Select Payroll Period:</label>
      <select name="pay_period_id" id="pay_period_id" required
        style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; margin-top: 8px; margin-bottom: 16px;">
        <option value="">-- Choose Payroll Period --</option>
        {% for p in payroll_periods %}
          <option value="{{ p.id }}">
            {{ p.start_date.strftime('%B %d, %Y') }} — {{ p.end_date.strftime('%B %d, %Y') }}
          </option>
        {% endfor %}
      </select>

      <button type="button" id="generateBtn"
        style="width: 100%; background-color: #198754; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer;">
        Generate Payslips
      </button>

      <a href="{{ url_for('payroll_staff.view_payslips') }}" 
        style="display: block; text-align: center; margin-top: 12px; color: #3d6ef7; text-decoration: none;">
        ← Back to Payslip List
      </a>
    </form>
  </div>
</main>

<!-- SweetAlert Confirmation -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.getElementById("generateBtn").addEventListener("click", function() {
  const period = document.getElementById("pay_period_id").value;
  if (!period) {
    Swal.fire('No Period Selected', 'Please choose a payroll period first.', 'warning');
    return;
  }

  Swal.fire({
    title: 'Generate Payslips?',
    text: 'Payslips will be generated for all employees under the selected payroll period.',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#198754',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Yes, generate',
    cancelButtonText: 'Cancel'
  }).then((result) => {
    if (result.isConfirmed) {
      document.getElementById("generateForm").submit();
    }
  });
});
</script>
{% endblock %}
